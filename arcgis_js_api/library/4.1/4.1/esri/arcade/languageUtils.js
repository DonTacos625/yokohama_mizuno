// COPYRIGHT © 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.

define(["require","exports","../geometry/Geometry","../moment","dojo/number","./ImmutableArray","../kernel","./ImmutablePointArray","./ImmutablePathArray","dojo/_base/array","../geometry/Point","./FunctionWrapper"],function(e,n,r,t,i,u,o,a,f,l,c,d){function s(e,n,r){if(""===n)return e;if(null===n)return e;if(void 0===n)return e;if(n===r)return e;if(n===r)return e;do e=e.replace(n,r);while(-1!==e.indexOf(n));return e}function m(e){return e instanceof G||e instanceof d}function v(e){return p(e)?!0:y(e)?!0:O(e)?!0:x(e)?!0:null===e?!0:e===n.voidOperation?!0:"number"==typeof e?!0:!1}function g(e,n){return void 0===e?n:e}function p(e){return"string"==typeof e||e instanceof String}function x(e){return"boolean"==typeof e}function y(e){return"number"==typeof e}function h(e){return e instanceof Array}function T(e){return e instanceof u}function O(e){return e instanceof Date}function b(e,n,r){if(e.length<n||e.length>r)throw new Error("Function called with wrong number of Parameters")}function N(){var e=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===n?r:3&r|8).toString(16)});return n}function I(e,n){return isNaN(e)===!1?void 0===n||null===n||""===n?e.toString():(n=s(n,"‰",""),n=s(n,"¤",""),i.format(e,{pattern:n})):e.toString()}function S(e,n){var r=t(e);return void 0===n||null===n||""===n?r.format():r.format(n)}function C(e,n,r){switch(r){case">":return e>n;case"<":return n>e;case">=":return e>=n;case"<=":return n>=e}return!1}function j(e,r,t){if(null===e){if(null===r||r===n.voidOperation)return C(null,null,t);if(y(r))return C(0,r,t);if(p(r))return C(0,A(r),t);if(x(r))return C(0,A(r),t);if(O(r))return C(0,r.getTime(),t)}if(e===n.voidOperation){if(null===r||r===n.voidOperation)return C(null,null,t);if(y(r))return C(0,r,t);if(p(r))return C(0,A(r),t);if(x(r))return C(0,A(r),t);if(O(r))return C(0,r.getTime(),t)}else if(y(e)){if(y(r))return C(e,r,t);if(x(r))return C(e,A(r),t);if(null===r||r===n.voidOperation)return C(e,0,t);if(p(r))return C(e,A(r),t);if(O(r))return C(e,r.getTime(),t)}else if(p(e)){if(p(r))return C(V(e),V(r),t);if(O(r))return C(A(e),r.getTime(),t);if(y(r))return C(A(e),r,t);if(null===r||r===n.voidOperation)return C(A(e),0,t);if(x(r))return C(A(e),A(r),t)}else if(O(e)){if(O(r))return C(e,r,t);if(null===r||r===n.voidOperation)return C(e.getTime(),0,t);if(y(r))return C(e.getTime(),r,t);if(x(r))return C(e.getTime(),A(r),t);if(p(r))return C(e.getTime(),A(r),t)}else if(x(e)){if(x(r))return C(e,r,t);if(y(r))return C(A(e),A(r),t);if(O(r))return C(A(e),r.getTime(),t);if(null===r||r===n.voidOperation)return C(A(e),0,t);if(p(r))return C(A(e),A(r),t)}return D(e,r)&&("<="===t||">="===t)?!0:!1}function D(e,r){if(e===r)return!0;if(null===e&&r===n.voidOperation||null===r&&e===n.voidOperation)return!0;if(O(e)&&O(r))return e.getTime()===r.getTime();if(e instanceof f)return e.equalityTest(r);if(e instanceof a)return e.equalityTest(r);if(e instanceof c&&r instanceof c){var t=void 0,i=void 0;if(n.isVersion4?(t=e.cache._arcadeCacheId,i=r.cache._arcadeCacheId):(t=e.getCacheValue("_arcadeCacheId"),i=r.getCacheValue("_arcadeCacheId")),void 0!==t&&null!==t)return t===i}return void 0!==e&&void 0!==r&&null!==e&&null!==r&&"object"==typeof e&&"object"==typeof r&&e._arcadeCacheId===r._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId?!0:!1}function V(e,t){if(p(e))return e;if(null===e)return"";if(y(e))return I(e,t);if(x(e))return e.toString();if(O(e))return S(e,t);if(e instanceof r)return JSON.stringify(e.toJson());if(h(e)){for(var i=[],o=0;o<e.length;o++)i[o]=w(e[o]);return"["+i.join(",")+"]"}if(e instanceof u){for(var i=[],o=0;o<e.length();o++)i[o]=w(e.get(o));return"["+i.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():m(e)?"object, Function":(e===n.voidOperation,"")}function _(e){var n=[];if(h(e)===!1)return null;if(e instanceof u){for(var r=0;r<e.length();r++)n[r]=A(e.get(r));return n}for(var r=0;r<e.length;r++)n[r]=A(e[r]);return n}function R(e,t){if(p(e))return e;if(null===e)return"";if(y(e))return I(e,t);if(x(e))return e.toString();if(O(e))return S(e,t);if(e instanceof r)return JSON.stringify(e.toJSON());if(h(e)){for(var i=[],o=0;o<e.length;o++)i[o]=w(e[o]);return"["+i.join(",")+"]"}if(e instanceof u){for(var i=[],o=0;o<e.length();o++)i[o]=w(e.get(o));return"["+i.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():m(e)?"object, Function":(e===n.voidOperation,"")}function w(e){if(null===e)return"null";if(x(e)||y(e)||p(e))return JSON.stringify(e);if(e instanceof r)return R(e);if(e instanceof u)return R(e);if(e instanceof Array)return R(e);if(e instanceof Date)return JSON.stringify(e);if(null!==e&&"object"==typeof e){if(void 0!==e.castToText)return e.castToText()}else if(e===n.voidOperation)return"null";return"null"}function A(e,r){return y(e)?e:null===e?0:""===e?0:O(e)?NaN:x(e)?e?1:0:""===e?NaN:void 0===e?NaN:void 0!==r&&p(e)?(r=s(r,"‰",""),r=s(r,"¤",""),i.parse(e,{pattern:r})):e===n.voidOperation?0:Number(e)}function F(e,n){if(O(e))return e;if(p(e)){var r=t(e,[void 0===n||null===n||""===n?t.ISO_8601:n]);if(r.isValid())return r.toDate()}return null}function J(e,n){if(O(e))return t(e);if(p(e)){var r=t(e,[void 0===n||null===n||""===n?t.ISO_8601:n]);if(r.isValid())return r}return null}function P(e){return x(e)?e:p(e)?(e=e.toLowerCase(),"true"===e?!0:!1):y(e)?0===e?!1:isNaN(e)?!1:!0:!1}function q(e,n){return null===e?null:((null===e.spatialReference||void 0===e.spatialReference)&&(e.spatialReference=n),e)}function E(e,n){if(!e)return null;if(!e.domain)return null;var r=null;n="esriFieldTypeString"===e.field.type?V(n):A(n);for(var t=0;t<e.domain.codedValues.length;t++){var i=e.domain.codedValues[t];i.code===n&&(r=i)}return null===r?null:r.name}function L(e,n){if(!e)return null;if(!e.domain)return null;var r=null;n=V(n);for(var t=0;t<e.domain.codedValues.length;t++){var i=e.domain.codedValues[t];i.name===n&&(r=i)}return null===r?null:r.code}function U(e,n,r,t){if(void 0===r&&(r=null),!n)return null;if(!n.fields)return null;for(var i=null,u=0;u<n.fields.length;u++){var o=n.fields[u];o.name.toLowerCase()===e.toString().toLowerCase()&&(i=o)}if(null===i)return null;var a,f;return t||(t=r&&n.typeIdField&&r._field(n.typeIdField)),null!=t&&l.some(n.types,function(e){return e.id===t?(a=e.domains&&e.domains[i.name],a&&"inherited"===a.type&&(a=k(i.name,n),f=!0),!0):!1},this),f||a||(a=k(e,n)),{field:i,domain:a}}function k(e,n){var r;return l.some(n.fields,function(n){return n.name===e&&(r=n.domain),!!r}),r}var B=function(){function e(e){this.value=e}return e}(),M=function(){function e(e){this.value=e}return e}(),G=function(){function e(e){this.fn=e}return e}();n.NativeFunction=G,n.ImplicitResult=M,n.ReturnResult=B,n.isVersion4=0===o.version.indexOf("4."),n.voidOperation={type:"VOID"},n.breakResult={type:"BREAK"},n.continueResult={type:"CONTINUE"},n.multiReplace=s,n.isFunctionParameter=m,n.isSimpleType=v,n.defaultUndefined=g,n.isString=p,n.isBoolean=x,n.isNumber=y,n.isArray=h,n.isImmutableArray=T,n.isDate=O,n.pcCheck=b,n.generateUUID=N,n.formatNumber=I,n.formatDate=S,n.greaterThanLessThan=j,n.equalityTest=D,n.toString=V,n.toNumberArray=_,n.toStringExplicit=R,n.toNumber=A,n.toDate=F,n.toDateM=J,n.toBoolean=P,n.fixSpatialReference=q,n.getDomainValue=E,n.getDomainCode=L,n.getDomain=U});